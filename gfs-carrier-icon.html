<link rel="import" href="../polymer/polymer.html" />
<dom-module id="gfs-carrier-icon">

    <template>
        <style>
            .icon {
                display: inline-block;
            }
            gfs-carrier-icon img {
                width: 50px!important;
            }
            .small img {
                height: 32px;
            }
            .medium img {
                height: 60px;
            }
            .large img {
                height: 78px;
            }

            @media (max-width: 490px) {
                .icon:nth-child(1n) {
                    margin: 0 0 10px
                }
            }

            @media (max-width: 320px) {
                .medium img {
                    height: 58px;
                }
            }
        </style>

        <div class$="icon {{iconSize}}">
            <a href="{{carrierURL}}" target="_blank"><img src="{{imagePath}}" /></a>
        </div>

    </template>

    <script>

        Polymer({
            is: "gfs-carrier-icon",

            properties: {
                carrierCode: {
                    type: String,
                    observer: 'onIconChanged',
                    notify: true,
                    reflectToAttribute: true
                },
                iconSize: {
                    type: String,
                    value: "medium"
                },
                imageUrl: {
                    type: String
                },
                carrierURL: {
                    type: String,
                    observer: 'onUrlChanged',
                    notify: true,
                    reflectToAttribute: true
                },
                url: {
                    type: String,
                    value: "url"
                },
                _carrierIndex: {
                    type: Object,
                    value: {
                        'dpd': {
                            'small': 'small/DPD logo cube small.png',
                            'medium': 'medium/dpd.png',
                            'large': 'medium/dpd.png',
                            'largest': 'medium/dpd.png',
                            'url': 'https://www.dpd.com/'
                        },
                        'doddle': {
                            'small': 'small/doddle.png',
                            'medium': 'medium/doddle.png',
                            'large': 'medium/doddle.png',
                            'largest': 'medium/doddle.png',
                            'url': 'https://www.doddle.com/'
                        },
                        'collectplus': {
                            'small': 'small/carrier-collectplus.png',
                            'medium': 'medium/collectplus.png',
                            'large': 'medium/collectplus.png',
                            'largest': 'medium/collectplus.png',
                            'url': 'https://www.collectplus.co.uk/'
                        },
                        'hermes': {
                            'small': 'small/carrier-hermes.png',
                            'medium': 'medium/hermes.png',
                            'large': 'medium/hermes.png',
                            'largest': 'medium/hermes.png',
                            'url': 'https://www.myhermes.co.uk/'
                        },
                        'inpost': {
                            'small': 'small/carrier-inpost.png',
                            'medium': 'medium/inpost.png',
                            'large': 'medium/inpost.png',
                            'largest': 'medium/inpost.png',
                            'url': 'https://inpost.co.uk/'
                        },
                        'dpdPickup': {
                            'small': 'small/pickup logo cube small.png',
                            'medium': 'medium/pickup logo cube small.png',
                            'large': 'medium/pickup logo cube small.png',
                            'largest': 'medium/pickup logo cube small.png',
                            'url': 'https://www.dpd.com/nl_privatecustomers#!pickup'
                        }
                    }
                }
            },
            listeners: {

            },
            ready: function() {
                this.carrierURL = this._carrierIndex[this.carrierCode][this.url];
                this.imageUrl = this._carrierIndex[this.carrierCode][this.iconSize];
                window.addEventListener('droppoint-changed', this.onDroppointChanged.bind(this), false);
            },
            onDroppointChanged: function (e) {
                this.set("droppointData", e.detail);
                this.countryCode = this.droppointData.geoLocation.countryCode;
            },
            onIconChanged: function (providerName, countryCode) {
                this.carrierCode = providerName.replace(/\s/g, '').toLowerCase();
                this.carrierURL = this._carrierIndex[this.carrierCode][this.url];
                this.countryCode = document.querySelector('gfs-supported-carriers').countrycode;
                // get the image url based on country code
                this.imagePath = this._computeIcon(this.countryCode, providerName, this.iconSize);
            },
            onUrlChanged: function(carrierURL) {
                this.countryCode = document.querySelector('gfs-supported-carriers').countrycode;

                if(carrierURL === "https://www.myhermes.co.uk/") {
                    switch(this.countryCode) {
                        case "FR":
                            return this.carrierURL = "http://www.mondialrelay.fr/";
                        case "BE":
                            return this.carrierURL = "http://www.mondialrelay.be/fr-BE/";
                        case "ES":
                            return this.carrierURL = "http://www.puntopack.es/";
                        default:
                            return this.carrierURL;
                    }
                }
            },
            _computeIcon: function(countryCode, providerName, iconSize) {
                var carrierLink = this.resolveUrl('/bower_components/gfs-carrier-icon/images/');

                switch(countryCode) {
                    case "DE":
                        return carrierLink + iconSize + '/DE/' + providerName + '.png';
                    case "FR":
                    case "BE":
                    case "ES":
                        return carrierLink + iconSize + '/FR/' + providerName + '.png';
                    default:
                        return carrierLink + iconSize + '/GB/' + providerName + '.png';
                }
            },
        });
    </script>
</dom-module>
